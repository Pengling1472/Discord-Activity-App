import{g as n,a as r,s as g,b as t,m as c,t as d}from"./index-vPoiqXpL.js";class m{constructor(){this.gravity=.3,this.elasticity=.7,this.dy=0,this.width=800,this.height=800,this.x=311.1,this.y=0,this.stretch=0,this.baseY=this.y,this.bounces=3}draw(){t.drawImage(document.getElementById("gui"),0,0,1920,1080),t.drawImage(document.getElementById("day"),this.x,this.baseY,this.height,this.height),t.drawImage(document.getElementById(this.bounces>=3?"normal":"talking"),this.x,this.y+this.stretch,this.width,this.height-this.stretch),t.save(),t.beginPath(),t.arc(1492.2,70,40,0,2*Math.PI),t.clip(),t.drawImage(document.getElementById("avatar"),1452.2,30,80,80),t.restore(),t.fillStyle="white",t.textBaseline="top",t.textAlign="left",t.fillText(c.get("user").global_name,1542.2,30),t.fillText(c.get("data").user.coins+"G",1542.2,80)}update(){this.bounces<3&&this.dy!=0&&(this.stretch+=this.dy,this.dy+=this.gravity,this.stretch>this.baseY&&(this.dy=this.dy*-this.elasticity,this.bounces++,this.stretch=this.baseY)),this.draw()}bounce(){this.bounces>=3&&this.y==this.baseY&&(this.y=this.baseY,this.dy=-5,this.bounces=0)}}class w{constructor(){this.column=0,this.row=0,this.dialogue=[],this.newText=this.newDialogue("Hi, welcome to my shop! How can I help you?")}newDialogue(e){const i=e.split(" ").map(s=>s+" "),a=t.measureText(e).width,h=[];this.column=0,this.row=0,this.dialogue=[],this.text=e;for(let s=0;s<Math.round(a/1362.2)+1;s++){let l="";h.push([]);for(let u=0;i.length>0&&!(t.measureText(l).width+t.measureText(i[0]).width>1362.2);u++)l+=i.splice(0,1);h[s]=l}for(let s=0;s<h.length;s++)this.dialogue.push("");return h}update(){d%3==0&&(this.column<this.newText.length-1||this.column==0)&&(this.dialogue[this.column]+=this.newText[this.column].split("")[this.row],this.row++,this.row+1>this.newText[this.column].length&&(this.column++,this.row=0),n.get("merchant").bounce()),t.fillStyle="white",t.textBaseline="top",t.textAlign="left";for(const[e]of Object.keys(this.dialogue))t.fillText(this.dialogue[e],30,830+e*50)}}function f(){n.set("merchant",new m),n.set("dialogue",new w),n.set("button",new r(30,30,10,"Return"))}function x(o){const e=canvas.getBoundingClientRect(),i=n.get("button"),a=(o.clientX-e.left)*1920/e.width,h=(o.clientY-e.top)*1080/e.height;a>i.x&&a<i.x+i.width&&h>i.y&&h<i.y+i.height&&g("menu")}export{f as execute,x as onMouseDown};
