import{g as o,a as n,b as r}from"./index-vPoiqXpL.js";class g{constructor(s){this.width=[16,24,32,40][s],this.height=[16,24,32,40][s],this.markers=[40,100,240,400][s],this.firstClick=!1,this.flag=!1,this.mines=[],this.board=[],this.over=!1;for(let i=0;i<this.height;i++){this.board.push([]);for(let h=0;h<this.width;h++)this.board[i].push(new b(h,i,this.height))}}bombs(){t:for(let s=0;s<this.markers;){const i=Math.floor(Math.random()*this.width),h=Math.floor(Math.random()*this.height),[l,e]=this.firstClick;if(!this.board[h][i].mine){for(let t=-1;t<=1;t++)for(let a=-1;a<=1;a++)if(i==t+l&&h==a+e)continue t;for(let t=-1;t<=1;t++)for(let a=-1;a<=1;a++)i+t>=0&&i+t<this.width&&h+a>=0&&h+a<this.height&&this.board[h+a][i+t].int++;this.board[h][i].mine=!0,this.mines.push([i,h]),s++}}o.get("buttons").set("flag",new d(1466,canvas.height*.5,`🚩 ${o.get("board").markers}`))}reveal(s,i){if(this.over)return;const h=this.board[i][s];let l=0;if(this.flag&&h.hidden)return h.flag=!h.flag,this.markers+=h.flag?-1:1,o.get("buttons").get("flag").text=`🚩${this.markers}`;if(!h.flag){if(h.mine)return this.gameOver();if(h.hidden=!1,h.int==0)for(let e=-1;e<=1;e++)for(let t=-1;t<=1;t++)s+e>=0&&s+e<this.width&&i+t>=0&&i+t<this.height&&this.board[i+t][s+e].hidden&&this.reveal(s+e,i+t);if(h.int>0)for(let e=-1;e<=1;e++)for(let t=-1;t<=1;t++)s+e>=0&&s+e<this.width&&i+t>=0&&i+t<this.height&&this.board[i+t][s+e].flag&&l++;if(!this.flag&&l==h.int&&h.int!=0){for(let e=-1;e<=1;e++)for(let t=-1;t<=1;t++)if(s+e>=0&&s+e<this.width&&i+t>=0&&i+t<this.height){if(this.board[i+t][s+e].mine&&!this.board[i+t][s+e].flag)return this.gameOver();if(this.board[i+t][s+e].int==0){this.reveal(s+e,i+t);continue}!this.board[i+t][s+e].flag&&this.board[i+t][s+e].hidden&&(this.board[i+t][s+e].hidden=!1)}}}}gameOver(){for(const[s,i]of this.mines)this.board[i][s].hidden=!1,this.board[i][s].flag=!1;this.over=!0}update(){for(let s=0;s<this.height;s++)for(let i=0;i<this.width;i++)this.board[s][i].update()}}class b{constructor(s,i,h){this.size=952/h,this.x=484+this.size*s,this.y=64+this.size*i,this.hidden=!0,this.mine=!1,this.flag=!1,this.int=0}update(){this.hidden&&(r.fillStyle="#bfe17d"),this.mine&&!this.hidden&&(r.fillStyle="#db3236"),!this.mine&&!this.hidden&&(r.fillStyle="#e5c29f"),r.fillRect(this.x+1,this.y+1,this.size-2,this.size-2),r.font="20px Itim",r.fillStyle="#1976d2",r.textBaseline="middle",r.textAlign="center",this.flag&&r.fillText("🚩",this.x+this.size/2,this.y+this.size/2),!this.mine&&!this.hidden&&this.int!=0&&r.fillText(this.int,this.x+this.size/2,this.y+this.size/2)}}class d{constructor(s,i,h,l=!1){r.font="50px Itim",this.selected=l,this.text=h,this.x=s,this.y=i,this.width=r.measureText(h).width+40,this.height=70,this.stroke=10}update(){this.selected&&(r.fillStyle="white",r.beginPath(),r.roundRect(this.x,this.y,this.width,this.height,[this.height/2/2]),r.fill()),r.fillStyle="black",r.beginPath(),r.roundRect(this.x+this.stroke/2,this.y+this.stroke/2,this.width-this.stroke,this.height-this.stroke,[(this.height-this.stroke)/2/2]),r.fill(),r.save(),r.beginPath(),r.roundRect(this.x+this.stroke/2,this.y+this.stroke/2,this.width-this.stroke,this.height-this.stroke,[(this.height-this.stroke)/2/2]),r.clip(),r.font="50px Itim",r.fillStyle="white",r.textBaseline="middle",r.textAlign="center",r.fillText(this.text,this.x+this.width/2,this.y+this.height/2),r.restore()}}function u(){o.set("board",new g(3)),o.set("buttons",new Map([["mining",new d(1466,canvas.height*.4,"⛏️",!0)]])),o.set("button",new n(30,30,10,"Return"))}function m(f){f.preventDefault();const s=canvas.getBoundingClientRect(),i=(f.clientX-s.left)*1920/s.width,h=(f.clientY-s.top)*1080/s.height;if(f.button==2){o.get("board").flag=!0;for(let l=0;l<o.get("board").height;l++)for(let e=0;e<o.get("board").width;e++){const t=o.get("board").board[l][e];i>t.x&&i<t.x+t.size&&h>t.y&&h<t.y+t.size&&(o.get("board").firstClick||(o.get("board").firstClick=[e,l],o.get("board").bombs()),o.get("board").reveal(e,l))}o.get("board").flag=!1;return}o.get("buttons").has("flag")&&(o.get("board").flag=o.get("buttons").get("flag").selected);for(const[l,e]of[...o.get("buttons").entries()])if(i>e.x&&i<e.x+e.width&&h>e.y&&h<e.y+e.height){for(const t of[...o.get("buttons").keys()])t!=l&&(o.get("buttons").get(t).selected=!1);e.selected=!0}for(let l=0;l<o.get("board").height;l++)for(let e=0;e<o.get("board").width;e++){const t=o.get("board").board[l][e];i>t.x&&i<t.x+t.size&&h>t.y&&h<t.y+t.size&&(o.get("board").firstClick||(o.get("board").firstClick=[e,l],o.get("board").bombs()),o.get("board").reveal(e,l))}}export{u as execute,m as onMouseDown};
